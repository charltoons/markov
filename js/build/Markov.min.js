/*! Markov 2013-11-17 */
function Front(a){"use strict";var b=[],c=[];return{add:function(d){var e=""+d.pixel.x+","+d.pixel.y;return d.pixel.x<0||d.pixel.y<0||d.pixel.x>=a.width||d.pixel.y>=a.height||b[e]===!0?!1:(c.push(d),b[e]=!0,!0)},get:function(){if(!(c.length<1)){var b=a.depthFirst,d=Math.max(0,b),e=1-Math.abs(b),f=(e*Math.random()+d)*c.length;return f=Math.min(c.length-1,Math.floor(f)),c.splice(f,1)[0]}},getLength:function(){return c.length}}}function Markov(a,b){"use strict";function c(a){return a.r+","+a.g+","+a.b}function d(a,b){"undefined"==typeof h[a]&&(h[a]=[]),b.r=e(b.r),b.g=e(b.g),b.b=e(b.b),h[a].push(b)}function e(a){var c=b.colorCompression;return Math.round(a/c)*c}function f(f,g,h){for(var i,j,k=f.x,l=f.y,m=4*(l*b.srcSize+k),n={r:e(a[m]),g:e(a[m+1]),b:e(a[m+2])},o=c(n),p=[{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}];p.length;)i=p.pop(),k+i.x<0||k+i.x>=g||l+i.y<0||l+i.y>=h||(j=m+4*(i.x+i.y*g),d(o,{r:a[j],g:a[j+1],b:a[j+2]}))}function g(){var a,c,d=b.srcSize,e=b.srcSize;for(c=0;e>c;c+=1)for(a=0;d>a;a+=1)f({x:a,y:c},d,e)}var h={};return g(),{getRandomColor:function(){var a=Object.keys(h),b=a[Math.floor(Math.random()*a.length)];return b=b.split(","),{r:b[0],g:b[1],b:b[2]}},getNeighbour:function(a){var b=h[c(a)];return b[Math.floor(Math.random()*b.length)]}}}window.requestAnimFrame=function(){"use strict";return window.requestAnimationFrame||window.webkitRequestAnimationFrame||window.mozRequestAnimationFrame||window.oRequestAnimationFrame||window.msRequestAnimationFrame||function(a){window.setTimeout(a,1e3/60)}}(),function(a,b){"use strict";function c(){G&&(window.requestAnimFrame(c),A.putImageData(C,0,0),G=F)}function d(a,b){var c=4*(a.x+v*a.y);return D[c]=b.r,D[c+1]=b.g,D[c+2]=b.b,D[c+3]=255,!0}function e(a,b){for(var c,d,e,f=[{x:-1,y:0},{x:1,y:0},{x:0,y:1},{x:0,y:-1}];f.length;)e=s.getNeighbour(b),d=Math.floor(f.length*Math.random()),c=f.splice(d,1)[0],u.add({pixel:{x:a.x+c.x,y:a.y+c.y},color:e})}function f(){for(var a=0;a<H.speed;a+=1){if(!u.getLength())return!1;var b=u.get(),c=b.color;d(b.pixel,c),e(b.pixel,c)}return!0}function g(){return F?f()?(setTimeout(g,0),void 0):(h(),void 0):void 0}function h(){console.log("Execution time: "+((new Date).getTime()-t)),F=!1}function i(){t=(new Date).getTime(),F=!0,G=!0,u.add({pixel:{x:Math.round(v/2),y:Math.round(w/2)},color:s.getRandomColor()}),g(),c()}function j(){u=new Front(H),v=H.width,w=H.height,x.css("width",v).css("height",w).attr("width",v).attr("height",w),A.fillStyle="#0a0a0a",A.fillRect(0,0,v,w),C=A.getImageData(0,0,v,w),D=C.data}function k(){h(),j(),i()}function l(){h(),z=new Image,z.onload=m,z.src=E}function m(){var b,c,d;j(),b=a('<canvas style="display: none" />').css("width",H.srcSize).css("height",H.srcSize).attr("width",H.srcSize).attr("height",H.srcSize),y.append(b),c=b[0].getContext("2d"),c.drawImage(z,0,0,H.srcSize,H.srcSize),d=c.getImageData(0,0,H.srcSize,H.srcSize).data,s=new Markov(d,H),b.remove(),i()}function n(a){a.originalEvent.stopPropagation(),a.originalEvent.preventDefault();var b,c=a.originalEvent.dataTransfer.files;c&&c.length&&(b=new FileReader,b.onload=function(a){E=a.target.result,l()},b.readAsDataURL(c[0]))}function o(a){a.bind("dragover",!1).bind("dragenter",!1).bind("drop",n)}function p(){open().document.write('<img src="'+x[0].toDataURL()+'"/>')}function q(){B=new dat.GUI,B.close(),B.add(H,"restart"),B.add(H,"depthFirst",-1,1).step(.01),B.add(H,"speed",0,1024).step(.01),B.add(H,"colorCompression",1,255).step(1).onFinishChange(m),B.add(H,"width",16,1920).step(1).onFinishChange(k),B.add(H,"height",16,1080).step(1).onFinishChange(k),a("#controls").on("click",function(){return B.open(),!1})}function r(){x=a("<canvas />").click(p),y=a(b).append(x),A=x[0].getContext("2d"),q(),o(a("html")),l()}var s,t,u,v,w,x,y,z,A,B,C,D,E="img/test.jpg",F=!1,G=!1,H={colorCompression:1,speed:100,depthFirst:.99,width:800,height:600,srcSize:256,restart:function(){try{k()}catch(a){}}};a(r)}(jQuery,"#photo","#busy"),function(global,undefined){"use strict";function canUseNextTick(){return"object"==typeof process&&"[object process]"===Object.prototype.toString.call(process)}function canUseMessageChannel(){return!!global.MessageChannel}function canUsePostMessage(){if(!global.postMessage||global.importScripts)return!1;var a=!0,b=global.onmessage;return global.onmessage=function(){a=!1},global.postMessage("","*"),global.onmessage=b,a}function canUseReadyStateChange(){return"document"in global&&"onreadystatechange"in global.document.createElement("script")}function installNextTickImplementation(a){a.setImmediate=function(){var a=tasks.addFromSetImmediateArguments(arguments);return process.nextTick(function(){tasks.runIfPresent(a)}),a}}function installMessageChannelImplementation(a){var b=new global.MessageChannel;b.port1.onmessage=function(a){var b=a.data;tasks.runIfPresent(b)},a.setImmediate=function(){var a=tasks.addFromSetImmediateArguments(arguments);return b.port2.postMessage(a),a}}function installPostMessageImplementation(a){function b(a,b){return"string"==typeof a&&a.substring(0,b.length)===b}function c(a){if(a.source===global&&b(a.data,d)){var c=a.data.substring(d.length);tasks.runIfPresent(c)}}var d="com.bn.NobleJS.setImmediate"+Math.random();global.addEventListener?global.addEventListener("message",c,!1):global.attachEvent("onmessage",c),a.setImmediate=function(){var a=tasks.addFromSetImmediateArguments(arguments);return global.postMessage(d+a,"*"),a}}function installReadyStateChangeImplementation(a){a.setImmediate=function(){var a=tasks.addFromSetImmediateArguments(arguments),b=global.document.createElement("script");return b.onreadystatechange=function(){tasks.runIfPresent(a),b.onreadystatechange=null,b.parentNode.removeChild(b),b=null},global.document.documentElement.appendChild(b),a}}function installSetTimeoutImplementation(a){a.setImmediate=function(){var a=tasks.addFromSetImmediateArguments(arguments);return global.setTimeout(function(){tasks.runIfPresent(a)},0),a}}var tasks=function(){function Task(a,b){this.handler=a,this.args=b}Task.prototype.run=function(){if("function"==typeof this.handler)this.handler.apply(undefined,this.args);else{var scriptSource=""+this.handler;eval(scriptSource)}};var nextHandle=1,tasksByHandle={},currentlyRunningATask=!1;return{addFromSetImmediateArguments:function(a){var b=a[0],c=Array.prototype.slice.call(a,1),d=new Task(b,c),e=nextHandle++;return tasksByHandle[e]=d,e},runIfPresent:function(a){if(currentlyRunningATask)global.setTimeout(function(){tasks.runIfPresent(a)},0);else{var b=tasksByHandle[a];if(b){currentlyRunningATask=!0;try{b.run()}finally{delete tasksByHandle[a],currentlyRunningATask=!1}}}},remove:function(a){delete tasksByHandle[a]}}}();if(!global.setImmediate){var attachTo="function"==typeof Object.getPrototypeOf&&"setTimeout"in Object.getPrototypeOf(global)?Object.getPrototypeOf(global):global;canUseNextTick()?installNextTickImplementation(attachTo):canUsePostMessage()?installPostMessageImplementation(attachTo):canUseMessageChannel()?installMessageChannelImplementation(attachTo):canUseReadyStateChange()?installReadyStateChangeImplementation(attachTo):installSetTimeoutImplementation(attachTo),attachTo.clearImmediate=tasks.remove}}("object"==typeof global&&global?global:this);